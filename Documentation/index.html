<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>APix</title>
    <link rel="stylesheet" href="scholarly.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body prefix="schema: http://schema.org/ xsd: http://www.w3.org/2001/XMLSchema# sa: https://ns.science.ai/">
<header>
    <p class="title">APix</p>
    <p class="subtitle">Documentation & Overview</p>
</header>
<article id="what" typeof="schema:ScholarlyArticle" resource="#">
    <h1>Documentation APix</h1>
    <section>
        <ol>
            <li property="schema:author" typeof="sa:ContributorRole">
                <a property="schema:author" typeof="schema:Person">
                    <span property="schema:givenName">Corodescu</span>
                    <span property="schema:familyName">Alin Andrei, </span>
                </a>
                <a property="schema:author" typeof="schema:Person">
                    <span property="schema:givenName">Humă</span>
                    <span property="schema:familyName">Cristian </span>
                </a>

            </li>
        </ol>
    </section>
    <section typeof="sa:Abstract" id="abstract">
        <h2>Abstract</h2>
        <p>
            APix is a web application that highlights teamwork and mobility in a small simple package,
            to enable users to draw collaboratively on a single canvas. Its working enviroment is a web browser
            (desktop and mobile orientated) but also offers its users to use their phone as a pointer for drawing on the
            canvas via an Android application.
    </section>
    <section typeof="sa:MaterialsAndMethods" id="motivation">
        <h2>Motivation</h2>
        <p>
            Similar applications, even though have a lot of drawing capabilities,
            do not offer support for alternative pointing devices, like the phone inside your pocket!

            [Experimental] -- responsive and good handle for static images
    </section>

    <section typeof="sa:Results" id="definition">
        <h2>Application summary</h2>
        <h4>Web</h4>
        <p>
            APix is a web based application where people can draw together on a web browser, on desktop or mobile,
            which offers multiple functionalities:
        <ul>
            <li>customizable canvas dimensions</li>
            <li>import a background image from any device</li>
            <li>basic drawing tools: brush thickness, color, eraser</li>
            <li>zooming and scrolling inside canvas</li>
            <li>export drawing in PNG/JPEG format</li>
            <li>collaborative work via shareable link</li>
        </ul>
        </p>

        <h4>Android</h4>
        <p>
            On a android side we developed a simple application using a "hybrid" approach,
            meaning that we create the user interface using HTML5, CSS3 and Javascript,
            which are interpreted inside an <a href="https://developer.android.com/reference/android/webkit/WebView.html"><i>WebView</i></a> component of the Android OS.
            It is currently still in an experimental state, due to the imprecision of
            accelerometers for the tasks we want to achieve (use it as as pointer).
            Some calibration could prove this feature usable, but this is out of the scope
            of the project.
        </p>
    </section>


    <section id="">
        <h2>Application arhitecture</h2>
        <br>
        <img src="./images/apix-architecture.png" style="float: center;" alt="Diagrama arhitecturală"/>
        <p class="imagetext">Fig. 1 - Application arhitecture diagram</p>

        <h2> The workflow of the application</h2>
        <p>
        <p>
            Upon entering on the website the user will be prompted with a dialog to set up the canvas suited for his
            needs:
            <ul>
                <li>width and height of the canvas</li>
                <li><i class="material-icons">image</i> - button to upload an image background</li>
            </ul>
            <img src="./images/Fig2.PNG" alt="Initial settings dialog for the user to enter in order to continue"/>
            <p class="imagetext">Fig. 2 - Initial settings dialog</p>
        </p>
        <p>
            <p>
                Before preceding to the next step, the user may be prompted with another dialog,
                in case the connection with the server could not be established.<br>
                <img src="images/Fig3.PNG" alt=" Network error dialog image"/>
                <p class="imagetext">Fig. 3 - Network error dialog</p>
            </p>
        <p>
            After submitting the initial settings he will be prompted to the actual working space: the canvas with the
            desired dimensions
            where he will observe various functionalities right next to the actual canvas:
            <ul>
            <li><i class="material-icons icon">content_cut</i> - eraser</li>
            <li><i class="material-icons icon">palette</i> - changing color input</li>
            <li><i class="material-icons icon">line_weight</i> - change brush thickness</li>
            <li><i class="material-icons icon">zoom_in</i> - enable zoom and scrolling inside canvas</li>
            </ul>
        <img src="images/Fig4.PNG" alt="Main page - the actual working space"/>
        <p class="imagetext">Fig. 4 - Actual working space</p>
        </p>
        <p>
            After the user got accustomed to drawing on the canvas and using all provided features,
            he has several options left. The options are revealed by pressing the <i class="material-icons">menu</i> icon
            in the top-left corner of the page and they consist of:
            <ul>
                <li><i class="material-icons icon">file_download</i>PNG - to export drawing in PNG format</li>
                <li><i class="material-icons icon">file_download</i>JPEG - to export drawing in JPEG format</li>
                <li><i class="material-icons icon">group_add</i> - to generate a shareable link to be sent to another drawing partner</li>
                <li><i class="material-icons icon">refresh</i> - to start a new, fresh session of drawing</li>
            </ul>

        <img src="images/Fig5.PNG" alt="Side menu for different features"/>
        <p class="imagetext">Fig. 5 - Side menu for different features</p>
        </p>
        <h3> Android companion - experimental</h3>
        The android companion is a simple-to-use app providing basic functionalities, enabling the device to be used as
        a pointer for APIx. On the main page, the application will render a HTML file linked to a Javascript file , which contains buttons
        for turning the pointer on and off, changing the color with which we are drawing, changing the brush thickness.
        Due to the experimental nature of the feature, we didn't put much effort on usability or user experience. As such,
        it currently connects automatically to the client with client id 1 (hardcoded value), and the pointer has its initial
        position hardcoded as well (100,100). The plan was to make to connection to the client via QR codes generated by the client,
        and could be implemented after solving its viability-as-a-pointer problems.

    </section>
    <div>
        <div class="android-page1">
            <img src=".\images\android-homepage2.jpg" alt="Home page Page"/>
            <p class="imagetext">Fig. 6 - Android Landing Page </p>
        </div>
        <div class="android-page2">
            <img src=".\images\android-homepage.jpg" alt="Home page Page"/>
            <p class="imagetext">Fig. 7 - Android Mainpage </p>
        </div>
    </div>

    <section id="file-headers">

        <h2>Technologies</h2>
        <p>
            <h4>Client Side</h4>
        TO ADD: background/drawable chache, creating from scratch the zoom functionality
        <p>
            To create APix we have used <i>HTML5</i>, <i>CSS3</i> and <i>JavaScript</i> for the frontend part but also
            some Material Design icons and suggestions for a pleasant UI. The project has been created without any external libraries
            for javascript and for that reason, HTML5 features & pure javascript to obtain different desired effects.
        </p>
        <p>
            The <i>canvas</i> element from HTML5 has been used repeatedly as the main object of this project
            was to be able to draw in a browser. We used 3 canvases: <i>background_canvas</i>, <i>drawable_canvas</i> and <i>visor_canvas</i>.
            The main point from this layering was to separate different meaning canvases:
            <ul>
            <li>the background_canvas - to store a image as background, which would not be changed</li>
            <li>the drawable_canvas - the canvas on which we actually draw and needed to be updated regularly</li>
            <li>the visor_canvas - the view to the first 2 canvases, taking into account the scrolling and the zoom used by the user</li>
            </ul>
        </p>
        <p>
            Regarding <i></i>javascript, we invested a lot of work into it as we needed to use only <i>pure javascript</i>.
            Because of this we implemented first basic functions: color choice, line thickness and upload of image background.
            Later on we tackled the issue of providing a reliable zoom effect and scroll effect. The zoom effect was later updated,
            to take into account the position of the mouse in order to zoom in a specific area where the mouse was pointing.

        </p>
            <h4>Server Side </h4>
        <p>
            For the server side we decided to use <i>cloud-computing</i> <a href="http://aws.amazon.com">solutions</a>,
            specifically <a href="https://aws.amazon.com/elasticbeanstalk/">Elastic Beanstalk</a> for the Web server, and
            the more general <a href="https://aws.amazon.com/ec2/">Elastic Compute Cloud</a> for the Synchronization server
            We designed the architecture specifically to be able to detach those two components, and they are currently running
            on two different hosts. <br/>
            We implemnted our solutions in Python, motivated by the speed with which one can get a server up and running using
            <a href="http://flask.pocoo.org/">Flask</a>for the Web server and <a href="https://github.com/crossbario/autobahn-python">Autobahn</a>
            for the Synchronization server. We made heavy use of HTML5 <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">Websockets</a>
            specification as well to manage the transfer of data in a faster and reliable way -- crucial aspect since our
            web application is a real-time collaborative application.
            The Synchronization server is based on our adaptation of the <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publish-Subscribe paradigm</a>
            where clients are both publishers and subscribers of a single topic (session in our case). This enables them to
            always stay up-to-date with the latest messages (drawing data updates) of the topic they are subscribed to.
            <br/>
            Another interesting solution was to use <a href="http://www.seleniumhq.org/">Selenium</a>, which is
            usually used to write tests for web pages, to always store a state of the canvases of different sessions, states
            which will be used in case a new client wants to join the session (the server will send the current state of
            the canvas to the client). We utilised Selenium by reading the updates sent by the clients and applying them
            to a page (stored in <a href="https://aws.amazon.com/s3">S3</a>) rendered in a headless Firefox browser, and to act as a intermediary between the Python code and the
            Javascript executed by the browser.


        </p>
            <h4> Android side </h4>
        <p>
            For the Android side we developed the solution using as much Javascript and as little native Android
            tools as possible. Thus, we made use of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/DeviceMotionEvent">DeviceMotionEvent</a>
            experimental technology to capture accelerometer data and try to use it to capture the movement of the device.
            It turns out that the accelerometers used in Android devices aren't precise enough to measure the distance
            travelled by the device, and thus cannot be used properly as pointers without some transformation techniques.
            At the moment there are some transformations in place which make the phone behave a bit more controllable,
            but they need some adjustments. Please refer to the
            <a href="https://github.com/alin-corodescu/CLIW-APIx/blob/master/Android/APIxController/app/src/main/assets/www/javascript/app.js#L69-L149">code</a>
            for more details.
        </p>
            <h4>Development method</h4>
            <p>
                For the development process we used <i>GitHub</i> to track down progress and fix bugs that appeared at some point.
                For new features we will create new branches which, after finishing the implementation, will
                be added to the master branch.
                Also, when trying to implement new features we usually created a new branch for further research and not to
                stop the development the project.
            </p>
        </p>
        <p>


        <h3>Task distribution</h3>
        <ul>
        <li> Cristian Huma
            <ul>
                <li>Frontend HTML5+CSS</li>
                <li>Backend Javascript + Php</li>
                <li>Documentation and demo</li>
            </ul>
        </li>
        </ul>

        <ul>
        <li> Corodescu Alin Andrei
            <ul>
                <li>Frontend HTML5+CSS</li>
                <li>Backend Javascript + Php</li>
                <li>Integration Android</li>
                <li>Documentation and demo</li>
            </ul>
        </li>
        </ul>


        <h2>Bibliography</h2>
        <ul>
            <li><a href="https://material.io/icons/">https://material.io/icons/</a></li>
            <li><a href="http://cheatsheetworld.com/programming/html5-canvas-cheat-sheet/">Canvas cheat sheet</a></li>
        </ul>

    </section>

</article>
</body>
</html>
